## 3D麻将框架开发--lua

### 3D 麻将框架图

![3D麻将框架图](pic/3D麻将框架图.png)

1. Mah3DInterface向外界暴露出麻将接口，比如显示牌墙、显示吃碰杠等；
2. MahLayer主要负责初始化各个模块--ComboLayer、MahWall、FlowerMahLayer、Outmahlayer、HandMahLayer、ClockLayer、UIButtonLayer等模块，以及实现大部分功能，统筹规划和调用上述的各个模块；
3. ComboLayer层负责实现麻将吃碰杠的显示；
4. MahWall主要负责麻将牌墙的显示；
5. FlowerMahLayer主要负责显示花牌；
6. OutMahLayer主要负责出牌区的显示；
7. HandmahLayer主要负责手牌的显示；
8. SelfHandMahLayer继承HandMahLayer，主要添加了手牌的触摸事件
9. ClockLayer主要负责计时器的显示；
10. UIButtonLayer主要负责吃碰杠等按钮的显示
11. Mah最底层的单个麻将子。

### 3D麻将单个模块的具体实现

1. Mah

```lua

```

2. ClockLayer
```lua
local clock
local scheduler=cc.Director:getInstance():getScheduler()
--初始化
function ClockLayer:Init(rootNode)
  clock=cc.CSLoader:createNodeWithVisibleSize("")
  rootNode:addChild(clock)
end
-- 开始时间
-- @param direct 方向或者是位置
-- @param time 计时器的时间
-- @return nil
function ClockLayer:StartClock(direct,time)
  clock:setVisible(true)
end
-- 结束计时器
function ClockLayer:StopClock()end
-- 重置计时器
function ClockLayer:ResetClock()end
```
3. UIButtonLayer
```lua
local buttonLists={}
local uiButtonLayer
-- 初始化
function UIButtonLayer:Init(rootNode)
  uiButtonLayer=cc.CSLoader:createNodeWithVisibleSize("")
  rootNode:addChild(uiButtonLayer)
  self:addButtonEvent()
end
-- 添加Button的点击事件
function UIButtonLayer:addButtonEvent()end
-- 显示Button
function UIButtonLayer:ShowButton()end
```
4. HandMahLayer
```lua
local handMahLayer
-- 初始化
function HandMahLayer:Init(rootNode)
    handMahLayer=cc.CSLoader:createNodeWithVisibleSize("")
    rootNode:addChild(handMahLayer)
end
-- 摸一张牌
function HandMahLayer:TakeAMah()end
-- 移除一张牌
function HandMahLayer:RemoveAMah()end
-- 设置手牌
function HandMahLayer:SetHandMahs()end
-- 播放手牌动画
function HandMahLayer:PlayHandAction()end
```
5. SelfHandMahLayer
```lua
function SelfHandMahLayer:AddTouchEvent()end
```
6. OutMahLayer
```lua
local outMahLayer
-- 初始化
function OutMahLayer:Init(rootNode)
    outMahLayer=cc.CSLoader:createNodeWithVisibleSize("")
    rootNode:addChild(outMahLayer)
end
-- 出牌区增加一张牌
function OutMahLayer:AddAOutMah()end
-- 移除一张牌
function OutMahLayer:RemoveAMah()end
-- 设置手牌
function OutMahLayer:SetHandMahs()end
-- 播放手牌动画
function OutMahLayer:PlayHandAction()end
```
7. FlowerMahLayer
```lua
local flowerMahLayer
-- 初始化
function FlowerMahLayer:Init(rootNode)
    flowerMahLayer=cc.CSLoader:createNodeWithVisibleSize("")
    rootNode:addChild(flowerMahLayer)
end
-- 花牌区增加一张花牌
function FlowerMahLayer:AddAFlowerMah()end
-- 花牌区移除一张花牌
function FlowerMahLayer:RemoveAFlowerMah()end
-- 花牌区设置花牌
function FlowerMahLayer:SetFlowerMahs()end
-- 播放花牌动画
function FlowerMahLayer:PlayFlowerAction()end
```
8. MahWallLayer
```lua
local mahWallLayer
-- 初始化
function MahWallLayer:Init(rootNode)
    mahWallLayer=cc.CSLoader:createNodeWithVisibleSize("")
    rootNode:addChild(mahWallLayer)
end
-- 显示牌墙
function MahWallLayer:AppearMahWall()end
-- 从牌墙移除一张牌
function MahWallLayer:RemoveAMah()end
-- 设置牌墙
function MahWallLayer:SetWallMahs()end
-- 播放牌墙动画
function MahWallLayer:PlayWallAction()end
```
9. ComboLayer


```lua
local comboLayer
-- 初始化
function ComboLayer:Init(rootNode)
    comboLayer=cc.CSLoader:createNodeWithVisibleSize("")
    rootNode:addChild(comboLayer)
end
-- 在牌型区增加一副牌
function ComboLayer:AddACombo()end
-- 设置牌型
function ComboLayer:SetComboMahs()end
-- 播放手牌动画
function ComboLayer:PlayComboAction()end
```

注释：可能有朋友觉得我这样写不符合面向对象的。干嘛不直接继承一个基类，然后在基类的基础上加以封装--毫无疑问这种做法这是可行的，但也是麻烦的，在上述框架的Layer层中每个模块各自负责一个模块，没有相互交接、相似性强的代码，虽然可能都叫一个名字。